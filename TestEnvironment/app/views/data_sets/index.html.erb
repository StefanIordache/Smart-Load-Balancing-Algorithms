<div class="row justify-content-md-center">
  <div class="row col col-lg-12 col-md-12">
    <h1 class="p-3 pb-5">Data Sets</h1>
  </div>

  <div class="row col col-lg-12 col-md-12">

    <div class="col col-lg-4 col-md-4">

      <div>
        <button type="button" class="btn btn-outline-primary btn-lg" id="button-create-new-data-set">Create Data Set
        </button>
      </div>
      <br>

      <label for="label-cluster">
        <h4>
          Data Set Description
        </h4>
      </label>

      <div id="jsoneditor-data-set" class="pt-3 pb-4" style="width: 100%; height: 180%;"></div>

    </div>

    <div class="col col-lg-8 col-md-8"></div>

  </div>
</div>

<div id="loading-screen-animation" style="display: none">
  <canvas id="c"></canvas>
  <div class="info">Click to add gravity point.</div>
</div>


<script>
    let containerDataSet = document.getElementById("jsoneditor-data-set");
    let options = {
        mode: "code"
    };
    let editorDataSet = new JSONEditor(containerDataSet, options);

    $(function () {
        const dummyDataSetUrl = "/dummy/data_set";

        axios.get(dummyDataSetUrl).then(function (response) {
            editorDataSet.set(response.data);
        });

    });

    function callDataSetGenerator(url, dataSetJson) {
        return axios
            .post(url, {
                payload_data_set: dataSetJson
            })
            .then(function (response) {
                return response;
            })
            .catch(function (error) {
                swal({
                    icon: "error",
                    text: "Error!"
                });
            });
    }

    $("#button-create-new-data-set").click(function () {
        let dataSetJson = editorDataSet.get();

        if (jQuery.isEmptyObject(dataSetJson)) {
            swal({
                icon: "error",
                text: "Please fill in data set details."
            });
        } else {
            const postUrl = "/create_new_data_set";
            startLoadingScreenAnimation();

            callDataSetGenerator(postUrl, dataSetJson).then(function (response) {
                stopLoadingScreenAnimation();

            }).catch(function (response) {
                stopLoadingScreenAnimation();
                console.log("error");
                swal({
                    icon: "error",
                    text: "Internal server error."
                });
            });

        }
    });
</script>